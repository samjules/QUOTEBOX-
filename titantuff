<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Tampa Moving Quote</title>
<style>
body { font-family: Arial; max-width: 600px; margin: auto; padding: 20px; }
.step { display: none; }
.active { display: block; }
.progress-bar { height: 8px; background: #eee; border-radius: 5px; margin-bottom: 20px; overflow: hidden; }
.progress { height: 8px; width: 33%; background: #1e90ff; transition: 0.3s; }
button { padding: 10px 15px; margin-top: 10px; cursor: pointer; }
input, select { width: 100%; padding: 8px; margin: 10px 0; }
.quote-display { font-size: 22px; font-weight: bold; margin: 10px 0; }
</style>
</head>
<body>

<h2>Tampa Instant Moving Quote</h2>
<p>$150/hr • 26ft Truck • 2 Movers • Gas & Supplies Included</p>

<div class="progress-bar">
  <div class="progress" id="progress"></div>
</div>

<form id="quoteForm">

<div class="step active">
  <label>Bedrooms</label>
  <select id="bedrooms">
    <option value="2">1-2 Bedrooms</option>
    <option value="3">3 Bedrooms</option>
    <option value="4">4+ Bedrooms</option>
  </select>

  <label>Estimated Hours (3 hour minimum)</label>
  <input type="number" id="hours" value="3" min="3" />

  <button type="button" onclick="nextStep()">Next</button>
</div>

<div class="step">
  <label>From City</label>
  <input type="text" id="fromCity" required />

  <label>To City</label>
  <input type="text" id="toCity" required />

  <div class="quote-display">
    Estimated Total: $<span id="price">450</span>
  </div>

  <button type="button" onclick="prevStep()">Back</button>
  <button type="button" onclick="nextStep()">Next</button>
</div>

<div class="step">
  <label>Your Name</label>
  <input type="text" id="name" required />

  <label>Email</label>
  <input type="email" id="email" required />

  <label>Phone</label>
  <input type="tel" id="phone" required />

  <button type="button" onclick="prevStep()">Back</button>
  <button type="submit">Submit Quote</button>
</div>

</form>

<script>
const OWNER_UID = "135f2fd0-ed5f-4563-977e-edbb2277b4aa";
const RATE = 150;
const FUNCTION_URL = "https://jpchpqjnyabtpptufkcj.functions.supabase.co/submit-lead";

let currentStep = 0;
const steps = document.querySelectorAll(".step");
const progress = document.getElementById("progress");

function showStep(i) {
  steps.forEach((step, index) => {
    step.classList.toggle("active", index === i);
  });
  progress.style.width = ((i + 1) / steps.length) * 100 + "%";
}

function nextStep() {
  if (currentStep < steps.length - 1) {
    currentStep++;
    calculatePrice();
    showStep(currentStep);
  }
}

function prevStep() {
  if (currentStep > 0) {
    currentStep--;
    showStep(currentStep);
  }
}

function calculatePrice() {
  let hours = parseInt(document.getElementById("hours").value);
  if (hours < 3) hours = 3;
  const total = hours * RATE;
  document.getElementById("price").innerText = total;
  return total;
}

document.getElementById("hours").addEventListener("input", calculatePrice);

document.getElementById("quoteForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const estimatedPrice = calculatePrice();

  const payload = {
    owner_uid: OWNER_UID,
    name: document.getElementById("name").value,
    email: document.getElementById("email").value,
    phone: document.getElementById("phone").value,
    form_type: "moving",
    form_data: {
      bedrooms: document.getElementById("bedrooms").value,
      hours: document.getElementById("hours").value,
      from_city: document.getElementById("fromCity").value,
      to_city: document.getElementById("toCity").value,
      estimated_price: estimatedPrice
    }
  };

  try {
    const response = await fetch(FUNCTION_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    if (!response.ok) {
      throw new Error("Network response not ok");
    }

    alert("Quote submitted successfully!");
    document.getElementById("quoteForm").reset();
    currentStep = 0;
    showStep(currentStep);

  } catch (error) {
    console.error(error);
    alert("Submission failed. Check console.");
  }
});

showStep(currentStep);
</script>

</body>
</html>
